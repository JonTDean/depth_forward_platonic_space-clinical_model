[tasks.build]
description = "Build the whole workspace"
command = "cargo"
args = ["build", "--workspace"]

[tasks.check]
description = "Type-check the whole workspace"
command = "cargo"
args = ["check", "--workspace"]

[tasks.fmt]
description = "Format all crates"
command = "cargo"
args = ["fmt", "--all"]

[tasks.clippy]
description = "Clippy lint (deny warnings)"
command = "cargo"
args = ["clippy", "--all-targets", "--", "-D", "warnings"]

[tasks.test]
description = "Run all tests (workspace libs + integration + curated doc tests)"
dependencies = ["test-workspace", "test-docs"]

[tasks.test-workspace]
description = "Run workspace libs + integration surfaces without bin/doc harness noise"
dependencies = ["test-libs", "test-suite"]

[tasks.test-libs]
command = "cargo"
args = [
    "test",
    "-p",
    "dfps_api",
    "-p",
    "dfps_core",
    "-p",
    "dfps_datamart",
    "-p",
    "dfps_ingestion",
    "-p",
    "dfps_mapping",
    "-p",
    "dfps_web_frontend",
    "--lib",
]

[tasks.test-suite]
command = "cargo"
args = [
    "test",
    "-p",
    "dfps_test_suite",
    "--test",
    "e2e_tests",
    "--test",
    "integration_tests",
    "--test",
    "unit_tests",
]

[tasks.test-docs]
description = "Run doc tests only for crates that actually host them"
script = [
    "cargo test -p dfps_core --doc",
]

[tasks.ci]
description = "CI convenience target (fmt + clippy + test)"
dependencies = ["fmt", "clippy", "test"]

[tasks.clean]
description = "Clean target dir and book output"
linux_alias = "clean-unix"
mac_alias = "clean-unix"
windows_alias = "clean-windows"

[tasks.clean-unix]
script_runner = "bash"
script = [
    "cargo clean",
    "rm -rf docs/book/book",
]

[tasks.clean-windows]
command = "powershell"
args = [
    "-NoLogo",
    "-NoProfile",
    "-Command",
    "cargo clean; if (Test-Path 'docs/book/book') { Remove-Item -Recurse -Force 'docs/book/book' }",
]
